services:
  jekyll:
    image: bretfisher/jekyll-serve
    volumes:
      - .:/site
    ports:
      - '4000:4000'

  obfuscate:
    image: node:20-alpine
    volumes:
      - .:/site
    working_dir: /site
    command: ["sh", "-c", "npm install -g terser && terser assets/js/password-protect.js --compress --mangle --mangle-props regex=/^_/ --output assets/js/password-protect.min.js && echo 'âœ… Obfuscated password-protect.js'"]

  compile-adrs:
    image: alpine:latest
    volumes:
      - ../documentation/adr:/source:ro
      - ./_adrs:/output
      - ./scripts:/scripts:ro
    command: ["sh", "/scripts/compile-adrs.sh"]
