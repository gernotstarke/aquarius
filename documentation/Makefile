.PHONY: help docs html pdf serve clean build-image

# Docker configuration
DOCKER_IMAGE := aquarius-docs:latest
DOCKER_RUN := docker run --rm -v $(CURDIR):/docs -w /docs $(DOCKER_IMAGE)

# Paths (relative to documentation/)
BUILD_DIR := build
SRC_DIR := .

##@ Documentation

help: ## Display this help message
	@awk 'BEGIN {FS = ":.*##"; printf "\nUsage:\n  make \033[36m<target>\033[0m\n"} /^[a-zA-Z_-]+:.*?##/ { printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2 } /^##@/ { printf "\n\033[1m%s\033[0m\n", substr($$0, 5) } ' $(MAKEFILE_LIST)

docs: html ## Generate all documentation
	@echo "‚úÖ Documentation generated!"
	@echo "   üìÑ View: $(BUILD_DIR)/aquarius-architecture.html"

html: ## Generate HTML documentation from AsciiDoc
	@echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
	@echo "üìÑ Generating HTML documentation..."
	@mkdir -p $(BUILD_DIR)
	@if command -v asciidoctor >/dev/null 2>&1; then \
		asciidoctor architecture/*.adoc \
			-D $(BUILD_DIR) \
			-a toc=left \
			-a toclevels=3 \
			-a sectnums \
			-a icons=font; \
		echo "‚úÖ HTML generated (local asciidoctor)"; \
	else \
		echo "‚ùå asciidoctor not found"; \
		echo "   Install: brew install asciidoctor"; \
		echo "   Or use: make build-image && make html"; \
		exit 1; \
	fi

pdf: ## Generate PDF documentation
	@echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
	@echo "üìë Generating PDF documentation..."
	@mkdir -p $(BUILD_DIR)
	@if command -v asciidoctor-pdf >/dev/null 2>&1; then \
		asciidoctor-pdf architecture/*.adoc \
			-D $(BUILD_DIR) \
			-a sectnums; \
		echo "‚úÖ PDF generated (local asciidoctor-pdf)"; \
	else \
		echo "‚ùå asciidoctor-pdf not found"; \
		echo "   Install: gem install asciidoctor-pdf"; \
		exit 1; \
	fi

serve: ## Serve documentation locally
	@echo "üåê Serving documentation at http://localhost:8000"
	@cd $(BUILD_DIR) && python3 -m http.server 8000

build-image: ## Build Docker image for documentation generation
	@echo "üê≥ Building documentation Docker image..."
	@cd .. && docker build -f Dockerfile.docs -t $(DOCKER_IMAGE) .
	@echo "‚úÖ Docker image built: $(DOCKER_IMAGE)"

clean: ## Clean build artifacts
	@echo "üßπ Cleaning documentation..."
	@rm -rf $(BUILD_DIR)
	@echo "‚úÖ Cleanup complete!"
